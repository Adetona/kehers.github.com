<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@kehers">
  <meta name="twitter:title" content="MongoDB; the why">
  <meta name="twitter:description" content="I have heard lots of arguments against MongoDB (NoSQL generally). One wrong assumption that generates this is that MongoDB is a SQL database replacement. It is not. However, there are certain data ...">
  <meta name="twitter:creator" content="@kehers">
  <title>MongoDB; the why</title>
  <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/normalize.css">
  <link rel="stylesheet" href="/assets/css/skeleton.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/zenburn.css" />
  <link rel="alternate" type="application/atom+xml" title="Blog post feed" href="/feed.xml">
</head>
<body>

<div class="container">
  <header>
    <div class="row">
      <div id="logo" class="three columns">
      <div id="menu">☰</div>
      <h3><a href="/">/opeyemi</a></h3>
    </div>
      <nav class="nine columns">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/posts.html">Posts</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
          <li><a href="http://gum.co/Sxoj" class="bordered">Consuming REST APIs - a soft introduction</a></li>
      </ul>
      </nav>
    </div>
  </header>
  <div class="row">
    <div class="six offset-by-three columns">
      <article>
        <date>18 Jan 2015</date>
        <h1 class="title">MongoDB; the why</h1>
        <p>I have heard lots of arguments against MongoDB (NoSQL generally). One wrong assumption that generates this is that MongoDB is a SQL database replacement. It is not. However, there are certain data types and structures that are perfect for a NoSQL database. But even before you jump into making it your choice database for a project, you have to look at your data and be sure it is what you really need.</p>

<p>In MySQL, you can have multiple tables with one-to-many relationship.</p>

<p><strong>articles</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>author_user_id</th>
      <th>title</th>
      <th>body</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>MongoDB; the why</td>
      <td>I have heard lots of arguments…</td>
      <td>2015-01-01 18:01:01</td>
    </tr>
  </tbody>
</table>

<p><strong>users</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>username</th>
      <th>password</th>
      <th>avatar</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>kehers</td>
      <td>$2a$08$Lg5XF1Tt.X5TGyfb…</td>
      <td>u/213649?v=3</td>
    </tr>
  </tbody>
</table>

<p><strong>comments</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>article_id</th>
      <th>user_id</th>
      <th>body</th>
      <th>date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>I disagree. Here is what I think…</td>
      <td>2015-01-02 18:01:01</td>
    </tr>
  </tbody>
</table>

<p>A query to get comments will require a join of the <strong>comments</strong> and <strong>users</strong> table:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">select</span> <span class="n">u</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">avatar</span><span class="p">,</span> <span class="k">c</span><span class="p">.</span><span class="n">body</span> <span class="k">from</span> <span class="n">comments</span> <span class="k">c</span><span class="p">,</span> <span class="n">users</span> <span class="n">u</span>
<span class="k">where</span> <span class="k">c</span><span class="p">.</span><span class="n">article_id</span><span class="o">=</span><span class="err">{</span><span class="n">id</span><span class="err">}</span> <span class="k">and</span> <span class="k">c</span><span class="p">.</span><span class="n">user_id</span><span class="o">=</span><span class="n">u</span><span class="p">.</span><span class="n">id</span> <span class="k">order</span> <span class="k">by</span> <span class="k">c</span><span class="p">.</span><span class="n">date</span> <span class="k">desc</span></code></pre></figure>

<p>This is a luxury you can’t afford in MongoDB. If you will be doing lots of table relationships, MongoDB is not for the project. For simple joins with few tables, say two, you may. But anything more than that will lead to complications.</p>

<p>What MongoDB is great for is a data structure where you have entities that can contain every property they need on their own. Combine that with its great write speed and you get a perfect store for things like logs, events, stats and similar data.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">/*</span><span class="w">
</span><span class="err">*</span><span class="w"> </span><span class="err">crawler_logs</span><span class="w">
</span><span class="err">*/</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="err">title:</span><span class="w"> </span><span class="nt">"HTTP error"</span><span class="err">,</span><span class="w">
    </span><span class="err">content</span><span class="p">:</span><span class="w"> </span><span class="s2">"Failed to access example.com. Curl returns a 400 error."</span><span class="p">,</span><span class="w">
    </span><span class="err">stack</span><span class="p">:</span><span class="w"> </span><span class="s2">"pinger.js, line 45"</span><span class="w">
    </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Sun Jan 11 2015 00:10:16 GMT+0100 (WAT)"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">/*</span><span class="w">
</span><span class="err">*</span><span class="w"> </span><span class="err">user_events</span><span class="w">
</span><span class="err">*/</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="err">event:</span><span class="w"> </span><span class="nt">"Login"</span><span class="err">,</span><span class="w">
    </span><span class="err">ip</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.2.2"</span><span class="p">,</span><span class="w">
    </span><span class="err">user</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">id:</span><span class="w"> </span><span class="err">525e3fb3b218980d35000001,</span><span class="w">
        </span><span class="err">username:</span><span class="w"> </span><span class="nt">"opeyemi"</span><span class="w">
    </span><span class="err">}</span><span class="p">,</span><span class="w">
    </span><span class="err">date</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sun Jan 11 2015 00:12:42 GMT+0100 (WAT)"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>As you can see, each of the entries above contain all I need about the entry. I don’t need to pull an additional data from a different collection (what tables are called in MongoDB) to make sense of the entry or make it complete. (I will be representing MongoDB entries as JSON objects because it closely represents how they are stored).</p>

<p>But MongoDB is not only good for logs. Consider a simple contact entity with the properties:</p>

<ul>
  <li>Name</li>
  <li>Numbers</li>
  <li>Emails</li>
</ul>

<p>A contact may contain multiple numbers and emails. We can represent this in MySQL with a one-to-many relationship model like this:</p>

<p><strong>contacts</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>..</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Opeyemi O.</td>
      <td>..</td>
    </tr>
  </tbody>
</table>

<p><strong>numbers</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>contact_id</th>
      <th>number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>08181019</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>08069018</td>
    </tr>
  </tbody>
</table>

<p><strong>emails</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>contact_id</th>
      <th>email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>kehers@gmail.com</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>ope@fonebaselabs.com</td>
    </tr>
  </tbody>
</table>

<p>Well, we can argue it can as well be represented in a single table like this:</p>

<p><strong>contacts</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>numebrs</th>
      <th>emails</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Opeyemi O.</td>
      <td>08181019,08069018</td>
      <td>kehers@gmail.com,ope@fonebaselabs.com</td>
    </tr>
  </tbody>
</table>

<p>(CRUD operations will not be as easy as with the one-to-many model but <a href="http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_find-in-set">find_in_set</a> can really be a helper). However, if we throw in one more contact property - organisations, with title and position columns, a single table with find_in_set won’t save us now. We will have to go back to our one-to-many relationship.</p>

<p><strong>contacts</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>..</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Opeyemi O.</td>
      <td>..</td>
    </tr>
  </tbody>
</table>

<p><strong>numbers</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>contact_id</th>
      <th>number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>08181019</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>08069018</td>
    </tr>
  </tbody>
</table>

<p><strong>emails</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>contact_id</th>
      <th>email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>kehers@gmail.com</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>ope@fonebaselabs.com</td>
    </tr>
  </tbody>
</table>

<p><strong>organisations</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>contact_id</th>
      <th>title</th>
      <th>position</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>Fonebase Labs</td>
      <td>Co-founder</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>Life</td>
      <td>Learner</td>
    </tr>
  </tbody>
</table>

<p>There, we have another data structure we can use MongoDB for. With MongoDB, we can represent the model in one collection:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">/*</span><span class="w">
</span><span class="err">*</span><span class="w"> </span><span class="err">contacts</span><span class="w">
</span><span class="err">*/</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="err">name:</span><span class="w"> </span><span class="nt">"Opeyemi O"</span><span class="err">,</span><span class="w">
  </span><span class="err">email</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"kehers@gmail.com"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ope@fonebaselabs.com"</span><span class="p">],</span><span class="w">
  </span><span class="err">numbers</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"08181019"</span><span class="p">,</span><span class="w"> </span><span class="s2">"08069018"</span><span class="p">],</span><span class="w">
  </span><span class="err">organisations</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
     </span><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="nt">"Fonebase Labs"</span><span class="err">,</span><span class="w"> </span><span class="err">position</span><span class="p">:</span><span class="w"> </span><span class="s2">"Co-founder"</span><span class="p">},</span><span class="w">
     </span><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="nt">"Life"</span><span class="err">,</span><span class="w"> </span><span class="err">position</span><span class="p">:</span><span class="w"> </span><span class="s2">"Learner"</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>This simplifies the data structure and makes things a lot easier.</p>

<p>Let’s look at one more instance where using MongoDB makes sense. Imagine you are creating a platform as a service (PaaS) product and users can store data sets or metadata that can be anything - strings, arrays, e.t.c.</p>

<p>User A may have the following data:</p>

<ul>
  <li><strong>mailgun_key</strong>: pubkey-02iismi5n5xozcmeyu3-ymqe3f9-0da9</li>
  <li><strong>ses_id</strong>: AKIAIJAZC3A2OYRSUGVA</li>
  <li><strong>ses_key</strong>: aXTd5VlLfremkG5UyoB76tnTTo2jB9FrZVywFz</li>
</ul>

<p>User B may have this:</p>

<ul>
  <li><strong>app_key</strong>: pGX1NjfDEUV5i60vvKRjeA</li>
  <li><strong>oauth</strong>
    <ul>
      <li><strong>token</strong>: 16110519-JOpMUsEWcAVSr2ft4jYKrbD2o6K</li>
      <li><strong>secret</strong>: B1yH5DPHZ3qHe9y29Ugoa0Dz7iDpWyvuNoMNYJ</li>
    </ul>
  </li>
</ul>

<p>And User C this:</p>

<ul>
  <li><strong>title</strong>: Callbase</li>
  <li><strong>description</strong>: Set up a call center in 5 minutes</li>
  <li><strong>author</strong>: Fonebase labs</li>
  <li><strong>keywords</strong>: call center, telephony, customer care</li>
</ul>

<p>Because the expected data from the user is not predefined and the same, using a SQL database for storage will be complex. You can’t just go ahead creating columns for a data structure you have no idea of. With MongoDB however, this fits just perfectly as data down table (collection) rows do not need to have the same columns (name, data type or length).</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">/*</span><span class="w">
</span><span class="err">*</span><span class="w"> </span><span class="err">metadata</span><span class="w">
</span><span class="err">*/</span><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">mailgun_key:</span><span class="w"> </span><span class="nt">"pubkey-02iismi5n5xozcmeyu3-ymqe3f9-0da9"</span><span class="err">,</span><span class="w">
    </span><span class="err">ses_id</span><span class="p">:</span><span class="w"> </span><span class="s2">"AKIAIJAZC3A2OYRSUGVA"</span><span class="p">,</span><span class="w">
    </span><span class="err">ses_key</span><span class="p">:</span><span class="w"> </span><span class="s2">"aXTd5VlLfremkG5UyoB76tnTTo2jB9FrZVywFz"</span><span class="p">,</span><span class="w">
    </span><span class="err">user</span><span class="p">:</span><span class="w"> </span><span class="err">ObjectId(</span><span class="mi">167</span><span class="err">e</span><span class="mi">3</span><span class="err">d</span><span class="mi">8</span><span class="err">d</span><span class="mi">95699</span><span class="err">af</span><span class="mi">944000001</span><span class="err">)</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">app_key:</span><span class="w"> </span><span class="nt">"pGX1NjfDEUV5i60vvKRjeA"</span><span class="err">,</span><span class="w">
    </span><span class="err">oauth</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">token:</span><span class="w"> </span><span class="nt">"16110519-JOpMUsEWcAVSr2ft4jYKrbD2o6K"</span><span class="err">,</span><span class="w">
      </span><span class="err">secret</span><span class="p">:</span><span class="w"> </span><span class="s2">"B1yH5DPHZ3qHe9y29Ugoa0Dz7iDpWyvuNoMNYJ"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">user</span><span class="p">:</span><span class="w"> </span><span class="err">ObjectId(</span><span class="mi">525</span><span class="err">e</span><span class="mi">3</span><span class="err">fb</span><span class="mi">3</span><span class="err">b</span><span class="mi">218980</span><span class="err">d</span><span class="mi">35000001</span><span class="err">)</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="err">title:</span><span class="w"> </span><span class="nt">"Callbase"</span><span class="err">,</span><span class="w">
    </span><span class="err">description</span><span class="p">:</span><span class="w"> </span><span class="s2">"Set up a call center in 5 minutes"</span><span class="p">,</span><span class="w">
    </span><span class="err">author</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fonebase labs"</span><span class="p">,</span><span class="w">
    </span><span class="err">keywords</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"call center"</span><span class="p">,</span><span class="w"> </span><span class="s2">"telephony"</span><span class="p">,</span><span class="w"> </span><span class="s2">"customer care"</span><span class="p">],</span><span class="w">
    </span><span class="err">user</span><span class="p">:</span><span class="w"> </span><span class="err">ObjectId(</span><span class="mi">526</span><span class="err">fb</span><span class="mi">1</span><span class="err">fa</span><span class="mi">13</span><span class="err">d</span><span class="mi">4432</span><span class="err">c</span><span class="mi">6</span><span class="err">f</span><span class="mi">000004</span><span class="err">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

<p>As you can see, we can have a single collection (table) with totally different fields (columns).</p>

<p>In conclusion, the key is to understand your data structure and the most efficient way to store it. Where it gets interesting is that you can even use both types of database for a single project. You can store your core data in MySQL and have your logs and events in MongoDB. And sometimes, the project is a small one and all you need is a simple way to store few data like app configuration settings.</p>

      </article>
    </div>
  </div>
</div>
<div class="colophon">
  <div class="container">
    <div class="row">
      <div class="author six offset-by-three columns">
        <img src="https://igcdn-photos-f-a.akamaihd.net/hphotos-ak-xfp1/t51.2885-15/e15/10617063_553407278119581_1973098870_n.jpg" class="avi"> <p>My name is Opeyemi Obembe. I build things for web and mobile. You should follow me on Twitter (<a href="http://twitter.com/kehers">@kehers</a>).</p>
      </div>
    </div>
    <div class="row p-t-20">
      <div class="six offset-by-three columns">
        
        
        
        <article class="m-t-20">
          <h4 class="title m-b-20">Next post</h4>
          <h5 class="libre no-margin"><a href="/2014/11/17/a-year-and-two-interns.html">A year and two interns</a></h5>
        </article>
        
        <h4 class="title">Comments</h4>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'kehers';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="three offset-by-three columns">
        <a href="/">/opeyemi</a> · <a href="http://github.com/kehers/kehers.github.com">Source</a> · <a href="/feed.xml">RSS feed</a>
      </div>
      <div class="three columns">
        <a href="http://twitter.com/kehers">Twitter</a> · <a href="http://github.com/kehers">Github</a> · <a href="http://instagram.com/kehers">Instagram</a> · <a href="http://500px.com/kehers">500px</a>
    </div>
    </div>
  </div>
</footer>

<script type="text/javascript" src="/assets/js/menu.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-53373832-1', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>