<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@kehers">
  <meta name="twitter:title" content="Twilio's PHP library support for JSON">
  <meta name="twitter:description" content="I have been hacking Twilio for some days now and it's been fun.
The  Twilio API supports XML and JSON as response formats, XML being the  default. Twilio has also been generous to include sample li...">
  <meta name="twitter:creator" content="@kehers">
  <title>Twilio's PHP library support for JSON</title>
  <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/normalize.css">
  <link rel="stylesheet" href="/assets/css/skeleton.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/zenburn.css" />
  <link rel="alternate" type="application/atom+xml" title="Blog post feed" href="/feed.xml">
</head>
<body>

<div class="container">
  <header>
    <div class="row">
      <div id="logo" class="three columns">
      <div id="menu">☰</div>
      <h3><a href="/">/opeyemi</a></h3>
    </div>
      <nav class="nine columns">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/posts.html">Posts</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
          <li><a href="http://gum.co/Sxoj" class="bordered">Consuming REST APIs - a soft introduction</a></li>
      </ul>
      </nav>
    </div>
  </header>
  <div class="row">
    <div class="six offset-by-three columns">
      <article>
        <date>30 Dec 2010</date>
        <h1 class="title">Twilio's PHP library support for JSON</h1>
        <p>I have been hacking <a href="http://twilio.com/">Twilio</a> for some days now and it's been fun.</p>
<p>The  Twilio API supports XML and JSON as response formats, XML being the  default. Twilio has also been generous to include sample libraries in  various languages to play around the API. Thing however is that the PHP  library has support for only XML as the response type. Being a fan of  JSON (the reduction in data transfer as compared to XML among other  things), I added a little hack to the response class in the library.</p>
<p>So here is my new constructor of the <strong>TwilioRestResponse</strong> class:</p>
<p><figure class="highlight"><pre><code class="language-php" data-lang="php"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="cp">&lt;?php</span>
<span class="c1">// ...
</span>         <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$text</span><span class="p">,</span> <span class="nv">$status</span><span class="p">)</span> <span class="p">{</span>
             <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/([^?]+)\??(.*)/'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Url</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">QueryString</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ResponseText</span> <span class="o">=</span> <span class="nv">$text</span><span class="p">;</span>
             <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">HttpStatus</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
             <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">HttpStatus</span> <span class="o">!=</span> <span class="mi">204</span><span class="p">)</span> <span class="c1">// HTTP 204 =&gt; No content
</span>                 <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ResponseJson</span> <span class="o">=</span> <span class="o">@</span><span class="nb">json_decode</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
             
             <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">IsError</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$status</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">))</span>
                 <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ErrorMessage</span> <span class="o">=</span>
                     <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ResponseJson</span><span class="o">-&gt;</span><span class="na">message</span><span class="p">;</span>
 
             <span class="cm">/*if($this-&gt;HttpStatus != 204)
                 $this-&gt;ResponseXml = @simplexml_load_string($text);
             
             if($this-&gt;IsError = ($status &gt;= 400))
                 $this-&gt;ErrorMessage =
                     (string)$this-&gt;ResponseXml-&gt;RestException-&gt;Message;
             //*/</span>
         <span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure></p>
      </article>
    </div>
  </div>
</div>
<div class="colophon">
  <div class="container">
    <div class="row">
      <div class="author six offset-by-three columns">
        <img src="https://igcdn-photos-f-a.akamaihd.net/hphotos-ak-xfp1/t51.2885-15/e15/10617063_553407278119581_1973098870_n.jpg" class="avi"> <p>My name is Opeyemi Obembe. I build things for web and mobile. You should follow me on Twitter (<a href="http://twitter.com/kehers">@kehers</a>).</p>
      </div>
    </div>
    <div class="row p-t-20">
      <div class="six offset-by-three columns">
        
        
        
        <article class="m-t-20">
          <h4 class="title m-b-20">Next post</h4>
          <h5 class="libre no-margin"><a href="/2010/12/16/the-cost-of-free.html">The cost of free</a></h5>
        </article>
        
        <h4 class="title">Comments</h4>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'kehers';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="three offset-by-three columns">
        <a href="/">/opeyemi</a> · <a href="http://github.com/kehers/kehers.github.com">Source</a> · <a href="/feed.xml">RSS feed</a>
      </div>
      <div class="three columns">
        <a href="http://twitter.com/kehers">Twitter</a> · <a href="http://github.com/kehers">Github</a> · <a href="http://instagram.com/kehers">Instagram</a> · <a href="http://500px.com/kehers">500px</a>
    </div>
    </div>
  </div>
</footer>

<script type="text/javascript" src="/assets/js/menu.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-53373832-1', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>