<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@kehers">
  <meta name="twitter:title" content="Building an SMS spam filter">
  <meta name="twitter:description" content="TL;DR

I am experimenting with a spam filter for SMS. You can demo an implementation here: kehers.github.io/experiments/snag. (Or download here: github.com/kehers/snag). If you are interested in th...">
  <meta name="twitter:creator" content="@kehers">
  <title>Building an SMS spam filter</title>
  <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/normalize.css">
  <link rel="stylesheet" href="/assets/css/skeleton.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/zenburn.css" />
  <link rel="alternate" type="application/atom+xml" title="Blog post feed" href="/feed.xml">
</head>
<body>

<div class="container">
  <header>
    <div class="row">
      <div id="logo" class="three columns">
      <div id="menu">☰</div>
      <h3><a href="/">/opeyemi</a></h3>
    </div>
      <nav class="nine columns">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/posts.html">Posts</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
          <li><a href="http://gum.co/Sxoj" class="bordered">Consuming REST APIs - a soft introduction</a></li>
      </ul>
      </nav>
    </div>
  </header>
  <div class="row">
    <div class="six offset-by-three columns">
      <article>
        <date>07 Sep 2014</date>
        <h1 class="title">Building an SMS spam filter</h1>
        <p>TL;DR</p>

<p>I am experimenting with a spam filter for SMS. You can demo an implementation here: <a href="http://kehers.github.io/experiments/snag">kehers.github.io/experiments/snag</a>. (Or download here: <a href="http://github.com/kehers/snag">github.com/kehers/snag</a>). If you are interested in the final app, get notified here: <a href="https://tinyletter.com/kehers">tinyletter.com/kehers</a></p>

<p>/TL;DR</p>

<p>Addressing SMS spam (there has been a lot of it lately) is a simple thing theoretically.</p>

<ol>
  <li>Listen to incoming messages</li>
  <li>Detect if it is spam</li>
  <li>Block it. Or save it elsewhere. Or delete it. Whatever.</li>
</ol>

<p>1 and 3 are simple but 2 is a bit tricky. The easy way is to check if the sender id is in a list of senders that have been marked as spam. Or we can mark all SMS with a sender id that match a format, e.g numerical sender ids that is less than 8 characters, as spam.</p>

<blockquote class="twitter-tweet" lang="en"><p>if (sms.sender.length &lt; 8 &amp;&amp;&#10;    isDigit(sms.sender)) {&#10;    sms.delete();&#10;}</p>&mdash; Opeyemi Obembe (@kehers) <a href="https://twitter.com/kehers/status/497668397686333441">August 8, 2014</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>This works. But one, you have to keep marking new sender ids as spam. And then, some senders use the same sender id to send spam and non-spam messages - the sender id <strong>MTN N</strong> for example. Blocking all sender ids less than 8 characters in length won’t work efficiently either. Many important messages come from sender ids less than 8. My Etisalat data messages for example.</p>

<p>What about we detect spam SMS a similar way to how emails do it? We can use a simple classification algorithm, <a href="http://en.wikipedia.org/wiki/Bayesian_spam_filtering">Naive Bayes</a>, that is also used by many email spam filters.</p>

<h2 id="naive-bayes">Naive Bayes</h2>

<p>Naive Bayes uses <a href="http://en.wikipedia.org/wiki/Conditional_probability">conditional probabilities</a> to detect the likelihood that a word (or group of) belong to a category. In simple form, let’s assume the word “<strong>now</strong>” appears 3 times out of 84 spam words and just once out of 250 non-spam words (let’s call this ham). What is the probability that a message with <strong>now</strong> is a spam or ham? Well we can say, the probabilty that it is spam is 3/84 = 0.0357 and the probability that it is ham (not spam) is 1/250 = 0.004. Obviously, 0.0357 is more than 0.004, so we can say it is spam.</p>

<p>But it is not that straightforward. Here we are assuming many things. The real formula is</p>

<div class="highlighter-rouge"><pre class="highlight"><code>P(spam/now) = P(now/spam) * P(spam) / (P(now/spam) * P(spam) + P(now/ham) * P(ham))
P(ham/now) = P(now/ham) * P(ham) / (P(now/ham) * P(ham) + P(now/spam) * P(spam))
</code></pre>
</div>

<p>For our example, we are assuming equal probabilities that a message is spam or ham, i.e for every 2 messages, 1 is spam and the other is ham. This means P(spam) = P(ham) = 1/2.
Then again, both denominators (called evidence) are the same. They are constants so we can ignore them. This therefore reduces the formula to</p>

<div class="highlighter-rouge"><pre class="highlight"><code>P(spam/now) = P(now/spam)
P(ham/now) = P(now/ham)
</code></pre>
</div>

<p>Again, this is because we have just two categories - spam and ham and assuming equal probabilities of both.</p>

<h2 id="implementation">Implementation</h2>
<p>By using this algorithm, we can <a href="http://en.wikipedia.org/wiki/Naive_Bayes_spam_filtering#Combining_individual_probabilities">combine the probabilties</a> of words in an SMS. This means we find the probability of each word in the text and combine (multiply) them. For this experiment, I am using a modified version called <a href="http://en.wikipedia.org/wiki/Naive_Bayes_spam_filtering#Dealing_with_rare_words">corrected probability</a> to deal with [rare] words that may not exist in the training data.</p>

<p>There are other slight modifications here and there. One is ignoring words that are less than 3 characters in length. I still need to test if this is really necessary though. In SMS, every word seem to count - even stop words like <strong>a</strong>,<strong>at</strong>,<strong>be</strong>.</p>

<p>Another thing I am taking into consideration is case sensitivity of words. Therefore, the words <strong>free</strong> and <strong>FREE</strong> are considered different words and not the same. Spam messages use <strong>FREE</strong> (uppercase) a lot. A friend sending you a text with <strong>free</strong> will likely send it in lower case. This seem to improve the filter. (Still have to test extensively too).</p>

<h2 id="getting-training-data">Getting training data</h2>
<p>We need an existing set of data to train (get words and occurrence counts for) our filter. I synced my device to my PC and copied some of the spam messages I have received. I also created a <a href="https://docs.google.com/document/d/1TldaHwtLwuAq8paUyjLLUuJqthjYvymOMk5Op8gtR4Y/edit">Google doc</a> anyone can add to. I shared this on Twitter and the awesome people there have added to it.</p>

<h2 id="whats-next">What’s next?</h2>
<p>I have done a simple implementation in Javascript here: <a href="http://kehers.github.io/experiments/snag">kehers.github.io/experiments/snag</a>. I used some of the spam and non-spam messages from my inbox as training data. You can check it out, and test with some SMS. It may not be 100% accurate yet as I used just a few training data. You can also download the source here: <a href="http://github.com/kehers/snag">github.com/kehers/snag</a>. It is just a few lines of Javascript. I am using this to test possible heuristics before implementing on mobile - android to start with. To be notified when it is completed, add your email here: <a href="https://tinyletter.com/kehers">tinyletter.com/kehers</a>.</p>

<p>Do let me know what you think. You can buzz me on twitter via <a href="http://twitter.com/kehers">@kehers</a>.</p>

      </article>
    </div>
  </div>
</div>
<div class="colophon">
  <div class="container">
    <div class="row">
      <div class="author six offset-by-three columns">
        <img src="https://igcdn-photos-f-a.akamaihd.net/hphotos-ak-xfp1/t51.2885-15/e15/10617063_553407278119581_1973098870_n.jpg" class="avi"> <p>My name is Opeyemi Obembe. I build things for web and mobile. You should follow me on Twitter (<a href="http://twitter.com/kehers">@kehers</a>).</p>
      </div>
    </div>
    <div class="row p-t-20">
      <div class="six offset-by-three columns">
        
        
        
        <article class="m-t-20">
          <h4 class="title m-b-20">Next post</h4>
          <h5 class="libre no-margin"><a href="/2014/08/16/a-quick-look-at-twitter-analytics-and-twitter-cards.html">A quick look at Twitter analytics [and Twitter cards]</a></h5>
        </article>
        
        <h4 class="title">Comments</h4>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'kehers';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="three offset-by-three columns">
        <a href="/">/opeyemi</a> · <a href="http://github.com/kehers/kehers.github.com">Source</a> · <a href="/feed.xml">RSS feed</a>
      </div>
      <div class="three columns">
        <a href="http://twitter.com/kehers">Twitter</a> · <a href="http://github.com/kehers">Github</a> · <a href="http://instagram.com/kehers">Instagram</a> · <a href="http://500px.com/kehers">500px</a>
    </div>
    </div>
  </div>
</footer>

<script type="text/javascript" src="/assets/js/menu.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-53373832-1', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>