!function(){function m(b,c,d){c||(c=f.left,d=f.top,a.remove(f),f=null),f=new fabric.Image(b,{evented:!0,selectable:!0,hasControls:!1,left:c,top:d,scaleX:.6,scaleY:.6,hasBorders:!1}),a.add(f)}function n(a){for(var b=a.split(","),c=b[0].match(/:(.*?);/)[1],d=atob(b[1]),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return new Blob([f],{type:c})}function o(){var b=window.innerWidth>0?window.innerWidth:screen.width;if(b<960){l=b/640;var c=640*l;$(".canvas-wrp, .container").css({width:c+"px",height:c+"px",marginTop:"0"}),$(".canvas-wrp, .logo-wrp").css({float:"none"}),$(".logo-wrp").css({marginTop:0,textAlign:"center",width:"100%"}),$(".btn-container").css({width:c+"px"}),$(".logo-wrp img").css({width:"45%"}),a.setWidth(c),a.setHeight(c),a.setZoom(l)}}var f,g,h,i,k,a=this.__canvas=new fabric.Canvas("c"),b=!1,c=!0,d=document.getElementById("fl-b-o"),e=document.getElementById("fl-w-o"),l=1;fabric.Image.fromURL("assets/images/overlay.png",function(b){b.evented=!1,b.width=640,b.height=640,b.selectable=!1,a.add(b),a.sendToBack(b)}),i=new fabric.Rect({id:"frame",top:0,left:0,width:638,height:638,fill:"transparent",stroke:"white",strokeWidth:2,selectable:!1,evented:!1}),a.add(i),$("#file-input").change(function(c){var d=c.target.files[0],e=/image.*/;if(d.type.match(e)){var f=new FileReader;f.onload=function(c){var d=new Image;d.src=c.target.result,d.onload=function(){b&&a.item(1).remove(),b=!0,h=new fabric.Image(d),EXIF.getData(d,function(){switch(EXIF.getTag(this,"Orientation")){case 8:h.setAngle(-90);break;case 3:h.setAngle(180);break;case 6:h.setAngle(90)}k=1,h.width<h.height?k=640/h.width:(h.height<h.width||h.height==h.width)&&(k=640/h.height),console.log(k),h.set({id:"image",originX:"center",originY:"center",scaleX:k,scaleY:k,top:320,left:320,hasControls:!1,selectable:!1,evented:!1}),a.add(h),a.sendToBack(h),a.bringForward(h),g=new fabric.Rect({id:"cropper",top:20,left:20,width:600,height:600,fill:"transparent",stroke:"#248ff4",strokeWidth:2,strokeDashArray:[5,5],selectable:!0,lockUniScaling:!0,hasBorders:!1,hasRotatingPoint:!1,cornerColor:"#248ff4",transparentCorners:!1,evented:!0}),a.add(g),a.setActiveObject(g),a.renderAll(),$(".pre").hide(),$("body").css({backgroundColor:"#777"}),$(".canvas").show(),$(".c-c").show()})}},f.readAsDataURL(d)}}),$("#fl-w").on("click",function(){return!!c&&($("img").removeClass("active"),$(this).addClass("active"),m(e),void(c=!1))}),$("#fl-b").on("click",function(){return!c&&($("img").removeClass("active"),$(this).addClass("active"),m(d),void(c=!0))}),$(".add").on("click",function(){return $("#file-input").trigger("click")}),$("#crop").on("click",function(){a.remove(g),i.visible=!1;var b=new Image;b.src=a.toDataURL({left:g.left*l,top:g.top*l,width:g.getWidth()*l,height:g.getHeight()*l}),b.onload=function(){a.remove(h),i.visible=!0,h=new fabric.Image(b),k=640/h.getHeight(),h.set({id:"image",originX:"center",originY:"center",scaleX:k,scaleY:k,top:320,left:320,hasControls:!1,selectable:!1,evented:!1}),h.setCoords(),a.add(h),a.sendToBack(h),a.bringForward(h),m(d,10,450),a.renderAll(),$(".crop-wrp").hide(),$(".dwn-wrp").show(),$(".logo-wrp").show()}}),$("#download").on("click",function(){ga("send","event","Image","download"),i.visible=!1,a.setWidth(1080),a.setHeight(1080),a.setZoom(1.6875);var b=/iPad|iPhone|iPod/.test(navigator.platform);if(b)$("#image").attr({src:a.toDataURL("image/png")}),$(".image-wrp").show(),$(".container, .btn-container").hide();else{var c=n(a.toDataURL("image/png"));$(this).attr({href:URL.createObjectURL(c),download:"flawless.png"})}a.setWidth(640),a.setHeight(640),a.setZoom(1),o(),i.visible=!0,a.renderAll()}),o(),window.addEventListener("resize",o,!1)}();