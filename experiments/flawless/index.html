<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <title>Dr Sid ft Korede Bello - Flawless aka #soFLAWLESS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Opeyemi Obembe (@kehers)">
  <link href='https://fonts.googleapis.com/css?family=Oswald:700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="assets/js/jquery-2.1.3.min.js"></script>
  <script type="text/javascript" src="assets/js/fabric.js"></script>
  <script src="assets/js/exif.js"></script>
  <link rel="stylesheet" href="assets/css/style.css?b">
</head>

<body style="background-color:#000;color:#fff">

<div class="pre container center" style="width:100%;max-width:960px">
  <img src="assets/images/logo.jpg" style="width:100%;max-width:960px">
  <h1 style="font-weight:normal;padding:10px;font-family:Oswald">Some #soFLAWLESS photos so far...</h1>
  <div class="video-wrp">
    <iframe src="http://www.youtube.com/embed/-Ghg4iJJWyc?rel=0&amp;controls=1&amp;showinfo=0" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
  </div>
  <div><input type="file" id="file-input" style="font-size:2em"></div>
  <button class="button add">Create your #soFLAWLESS image</button>
  <h2 style="font-weight:normal;padding:20px 38px;text-align:left;line-height:1.5em">Flawless aka #soFLAWLESS is the incredible new single from Mavin Records artist Dr Sid ft. Korede Bello. We have both decided to celebrate all the ladies on social media that are always #soFLAWLESS. If you are #soFLAWLESS, be a part of this celebration by putting the #soFLAWLESS filter on your image. You can do this on soflawless.com. Then post the image on social media with the hashtag #soFLAWLESS so we can celebrate you and have your image be a part of the social music video of Flawless. You may even get your own custom flawless social media video with all the #soFLAWLESS pics you create of yourself. Fellas, you can participate by adding your bae, your baby mama, your mom or any woman in your life that is #soFLAWLESS</h2>
  <img src="assets/images/album-cover.png" class="cover-a" style="float:left">
  <h1>Get the Flawless song from</h1>
  <p class="store-links"><a href="http://itunes.apple.com/album/id1149486064?ls=1&app=itunes"><img src="assets/images/itunes.png"></a> <a href="https://open.spotify.com/album/7K1xXZtpNYWsZH316KCFBz"><img src="assets/images/spotify.png"></a> <a href="https://itun.es/us/Wp8Geb"><img src="assets/images/apple_music.png"></a></p>
  <p class="center cover-b"><img src="assets/images/album-cover.png" class=""></p>
  <p>&nbsp;</p>
</div>

  <div class="container">
    <div class="canvas hide">
      <div class="row">
        <div class="canvas-wrp">
          <canvas id="c" width="640" height="640"></canvas>
        </div>
        <div class="logo-wrp hide">
          <img src="assets/images/flawless-white.png" id="fl-w"> <img src="assets/images/flawless-black.png" id="fl-b" class="active">
          <div class="hide"><img src="assets/images/flawless-white.png" id="fl-w-o"> <img src="assets/images/flawless-black.png" id="fl-b-o"></div>
        </div>
      </div>
      <p class="center btn-container crop-wrp" style="width:640px"><a href="#" class="button" id="crop">Crop</a></p>
      <p class="center btn-container dwn-wrp hide" style="width:640px"><a href="#" class="button" id="download">Download</a> <a href="?" class="button">Restart</a></span></p>
    </div>
  </div>
  <div class="image-wrp" style="text-align:center;display:none">
    <img id="image" download="flawless.png">
    <p style="box-sizing:border-box;padding:10px;font-size:140%">Long press image and select "Save Image" to download the image</p>
  </div>

  <script type="text/javascript">
  // Opeyemi Obembe (@kehers)
  $(window).load(function(){
    var canvas = this.__canvas = new fabric.Canvas('c');

    var added_photo = false;
    var black_stamped = true;
    var blackImgEl = document.getElementById('fl-b-o');
    var whiteImgEl = document.getElementById('fl-w-o');
    var stamp, cropper, image, frame;
    var wdt = 640, scale, scaleRatio = 1;

    function addStamp(imgElement, left, top) {
      if (!left) {
        // Get pos
        left = stamp.left;
        top = stamp.top;
        canvas.remove(stamp);
        stamp = null;
      }

      stamp = new fabric.Image(imgElement, {
          evented: true,
          selectable: true,
          hasControls: false,
          left: left,
          top: top,
          scaleX: 0.6,
          scaleY: 0.6,
          hasBorders: false
        });
      canvas.add(stamp);
    }

    function dataURLtoBlob(dataurl) {
      var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
          bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
      while(n--){
          u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], {type:mime});
    }

    // Gradient
    fabric.Image.fromURL('assets/images/overlay.png', function(img) {
      img.evented = false;
      img.width = 640;
      img.height = 640;
      img.selectable = false;
      canvas.add(img);
      canvas.sendToBack(img);
    });

    // Border
    frame = new fabric.Rect({
      id: 'frame',
      top: 0,
      left: 0,
      width: 638,
      height: 638,
      fill: 'transparent',
      stroke: 'white',
      strokeWidth: 2,
      selectable: false,
      evented: false
    });
    canvas.add(frame);

    // Upload image
    alert("Yo");
    $('#file-input').change(function(e) {
        alert("Change!");
        var file = e.target.files[0],
            imageType = /image.*/;

        if (!file.type.match(imageType))
            return;

        var reader = new FileReader();
        reader.onload = function (e) {

          var imgObj = new Image();
          imgObj.src = e.target.result;
          imgObj.onload = function () {
            // Remove added photo if exist
            if (added_photo) {
              canvas.item(1).remove();
            }

            added_photo = true;
            image = new fabric.Image(imgObj);
            EXIF.getData(imgObj, function() {
              switch(EXIF.getTag(this, 'Orientation')){
                 case 8:
                   image.setAngle(-90);
                   break;
                 case 3:
                   image.setAngle(180);
                   break;
                 case 6:
                   image.setAngle(90);
                   break;
              }

              scale = 1;
              if (image.width < image.height)
                scale = 640/image.width;
              else if (image.height < image.width ||
                 (image.height == image.width && image.width < 640))
                scale = 640/image.height;

              image.set({
                id: 'image',
                originX: "center",
                originY: "center",
                scaleX: scale,
                scaleY: scale,
                top: 320,
                left: 320,
                hasControls: false,
                selectable: false,
                evented: false
              });

              canvas.add(image);
              // index of 1
              canvas.sendToBack(image);
              canvas.bringForward(image);

              // Add cropper
              // Border
              cropper = new fabric.Rect({
                id: 'cropper',
                top: 120,
                left: 120,
                width: 400,
                height: 400,
                fill: 'transparent',
                stroke: '#248ff4',
                strokeWidth: 2,
                strokeDashArray: [5, 5],
                selectable: true,
                lockUniScaling: true,
                hasBorders: false,
                hasRotatingPoint: false,
                cornerColor: '#248ff4',
                transparentCorners: false,
                evented: true
              });
              canvas.add(cropper);
              canvas.setActiveObject(cropper);

              canvas.renderAll();

              // Show slider and download button
              //$('#scale-control').show();
              $('.pre').hide();
              $('body').css({backgroundColor: '#777'});
              $('.canvas').show();
            });
          }
        }
        reader.readAsDataURL(file);
    });

    $('#fl-w').on('click', function(){
      if (!black_stamped) return false;

      $('img').removeClass('active');
      $(this).addClass('active');
      addStamp(whiteImgEl);
      black_stamped = false;
    });
    $('#fl-b').on('click', function(){
      if (black_stamped) return false;

      $('img').removeClass('active');
      $(this).addClass('active');
      addStamp(blackImgEl);
      black_stamped = true;
    });

    $('.add').on('click', function(){
      $('#file-input').trigger('click');
      return false;
    });
    $('#crop').on('click', function(){
      canvas.remove(cropper);
      frame.visible = false;

      var cropped = new Image();
      cropped.src = canvas.toDataURL({
          left: cropper.left * scaleRatio,
          top: cropper.top * scaleRatio,
          width: cropper.getWidth() * scaleRatio,
          height: cropper.getHeight() * scaleRatio
      });
      cropped.onload = function() {
        //canvas.clear();
        canvas.remove(image);
        frame.visible = true;
        image = new fabric.Image(cropped);
        scale = 640/image.getHeight();
        image.set({
          id: 'image',
          originX: "center",
          originY: "center",
          scaleX: scale,
          scaleY: scale,
          top: 320,
          left: 320,
          hasControls: false,
          selectable: false,
          evented: false
        });
        image.setCoords();
        canvas.add(image);
        canvas.sendToBack(image);
        canvas.bringForward(image);

        // Add black
        addStamp(blackImgEl, 10, 450);

        canvas.renderAll();

        $('.crop-wrp').hide();
        $('.dwn-wrp').show();
        $('.logo-wrp').show();
      };
    });

    function resizeCanvas() {
      var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;
      if (width < 960) {
        scaleRatio = width/640;
        var dim = 640*scaleRatio;
        $('.canvas-wrp, .container').css({width: dim+'px', height: dim+'px', marginTop: '0'});
        $('.canvas-wrp, .logo-wrp').css({float: 'none'});
        $('.logo-wrp').css({marginTop: 0, textAlign: 'center', width: '100%'});
        $('.btn-container').css({width: dim+'px'});
        $('.logo-wrp img').css({width: '45%'});
        //$('.add').css({top: '20px', right: '20px', marginLeft: '0'});
        canvas.setWidth(dim);
        canvas.setHeight(dim);
        canvas.setZoom(scaleRatio);
      }
    }
    // Responsive scaling
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas, false);
  })
  </script>
  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84557605-1', 'auto');
  ga('send', 'pageview');
  </script>

</body>
</html>
